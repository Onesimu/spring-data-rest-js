"use strict";var _isB="undefined"==typeof exports;!function(t){function n(t){this.options=Object.assign({headers:{},body:null},t,o.config.globalFetchOptions),this.hasSend=!1,this.response=null,this.error=null,this.responseData=null}function e(t){function e(e){var i=e;return/^https?:\/\/.+$/g.test(e)||(i=o.config.baseURL+"/"+e),i=i.replace(/\/{2,}/g,"/").replace(/:\//g,"://"),new n({url:i,method:t})}return e}function i(t){return new Promise(function(n,e){if(s.isEntity(t))null==t.id?t.save().then(function(){n(t.href())})["catch"](function(t){e(t)}):n(t.href());else if(Array.isArray(t)){var r=[];for(var o in t)r.push(i(o));Promise.all(r).then(function(t){n(t)})["catch"](function(t){e(t)})}else if(null!=t&&t.constructor===Object){r=[];var a={},c=0;for(var u in t)t.hasOwnProperty(u)&&(a[c++]=u,r.push(i(t[u])));Promise.all(r).then(function(t){for(var e={},i=0;i<t.length;i++)e[a[i]]=t[i];n(e)})["catch"](function(t){e(t)})}else n(t)})}var r=_isB?window.fetch:require("node-fetch"),o={};o.config={globalFetchOptions:{},baseURL:"/",fetchStartHook:null,fetchEndHook:null},n.prototype.queryParam=function(t){if(null!=t){var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(e+"="+t[e]);this.options.url=this.options.url.split("?")[0]+"?"+n.join("&")}return this},n.prototype.jsonBody=function(t){return this.options.body=JSON.stringify(t),this.options.headers["Content-Type"]="application/json",this},n.prototype.formBody=function(t){var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(e+"="+t[e]);return this.options.body=n.join("&"),this.options.headers["Content-Type"]="application/x-www-form-urlencoded",this},n.prototype.send=function(){var t=this;return new Promise(function(n,e){if(t.hasSend)t.error?e(t):n(t.responseData);else{t.hasSend=!0;var i=o.config.fetchStartHook,s=o.config.fetchEndHook;i&&i(t),r(t.options.url,t.options).then(function(n){t.response=n;var e=n.headers.get("content-type");return null==e?Promise.resolve():/.*json.*/.test(e)?n.json():n.text()}).then(function(n){return t.responseData=n,t.response.ok?Promise.resolve(n):Promise.reject(n)}).then(function(e){s&&s(t),n(e)})["catch"](function(n){t.error=n,s&&s(t),e(t)})}})},n.prototype.then=function(t,n){return this.send().then(t)["catch"](n)},n.prototype.follow=function(t){var n=this;return new Promise(function(e,i){function r(s){var a=t.shift();if(a){var c=s._links,u=c[a];u?(u=u.href,o.get(u).send().then(function(t){r(t)})["catch"](function(t){i(t)})):(n.error="no key="+a+" \nin links="+JSON.stringify(c,null,4),i(n))}else e(s)}n.send().then(function(t){r(t)})["catch"](function(t){i(t)})})},o.get=e("GET"),o.post=e("POST"),o.patch=e("PATCH"),o.put=e("PUT"),o["delete"]=e("DELETE"),o.mockRequest=function(t){var e=t._links.self.href,i=new n({url:e,method:"GET"});return i.responseData=t,i.hasSend=!0,i},t.request=o;var s={};s.config={restBaseURL:"/"},s.isEntity=function(t){if(t){var n=t.href;return null!=n&&n.constructor===Function}return!1},s.extend=function(n){function e(n){var r=this;this.id=null,this._data={},this._modifyFileds=[],this.href=function(){var t;if(r._data&&(t=r._data._links),t)return t.self.href;if(r.id)return r.constructor.entityBaseURL+"/"+r.id;throw new Error("entity without id can't map to backend service:\n"+JSON.stringify(r))},this.get=function(t){return r._data[t]},this.set=function(t,n){this._modifyFileds.push(t),this._data[t]=n},this.data=function(){return r._data},this.patchData=function(t){for(var n in t)t.hasOwnProperty(n)&&this.set(n,t[n]);try{var e=t._links.self.href.split(/\//);e=e[e.length-1],null!=e&&(r.id=e)}catch(i){}},this._create=function(){return new Promise(function(t,n){i(r.data()).then(function(t){return o.post(r.constructor.entityBaseURL).jsonBody(t).send()}).then(function(n){r.patchData(n),t(n)})["catch"](function(t){n(t)})})},this._update=function(){for(var n={},e=this._data._links,a=[],c=0;c<r._modifyFileds.length;c++){var u=r._modifyFileds[c];if(!n.hasOwnProperty(u)&&"_"!==u[0]){var f=this.get(u);if(e[u]&&(s.isEntity(f)||Array.isArray(f)&&s.isEntity(f[0]))){f=i(f);var h=o.put(e[u].href).jsonBody(f);h.options.headers["Content-Type"]="text/uri-list",a.push(h.data())}else n[u]=f}}return new Promise(function(e,o){i(n).then(function(n){return a.unshift(t.request.patch(r.href()).jsonBody(n).send()),Promise.all(a)}).then(function(t){var n=t[0];r.patchData(n),e(n)})["catch"](function(t){o(t)})})},this.save=function(){return null!=r.id?r._update():r._create()},this["delete"]=function(){return e["delete"](r.id)},this.fetch=function(){return new Promise(function(t,n){e.findOne(r.id).then(function(n){var e=n.data();r.patchData(e),t(e)})["catch"](function(t){n(t)})})},this.follow=function(t){return new Promise(function(n,e){function i(){o.mockRequest(r._data).follow(t).then(function(t){n(t)})["catch"](function(t){e(t)})}r._modifyFileds.length>0?i():r.fetch().then(function(){i()})})},this.patchData(n)}function r(t){for(var n=[],i=t._embedded[e.entityName],r=0;r<i.length;r++)n.push(new e(i[r]));return n}return e.entityName=n,e.entityBaseURL=s.config.restBaseURL+"/"+e.entityName,e.findOne=function(t,n){if(t)return new Promise(function(i,r){o.get(e.entityBaseURL+"/"+t).queryParam(n).send().then(function(t){i(new e(t))})["catch"](function(t){r(t)})});throw new Error("require id")},e.findAll=function(t){return new Promise(function(n,i){o.get(e.entityBaseURL).queryParam(t).send().then(function(t){var e=r(t);e.page=t.page,n(e)})["catch"](function(t){i(t)})})},e.search=function(t,n){return new Promise(function(i,s){o.get(e.entityBaseURL+"/search/"+t).queryParam(n).send().then(function(t){try{i(r(t))}catch(n){i(new e(t))}})["catch"](function(t){s(t)})})},e["delete"]=function(t){return o["delete"](e.entityBaseURL+"/"+t).send()},e},t.entity=s}(_isB?this.spring={}:exports);
//# sourceMappingURL=dist/spring-data-rest.min.js.map