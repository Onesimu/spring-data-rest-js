"use strict";function _spring(t){function n(t){this.options=Object.assign({headers:{},body:null},t,o.config.globalFetchOptions),this.hasSend=!1,this.response=null,this.error=null,this.responseData=null}function e(t){function e(e){var i=e;return/^https?:\/\/.+$/g.test(e)||(i=o.config.baseURL+"/"+e),i=i.replace(/\/{2,}/g,"/").replace(/:\//g,"://"),new n({url:i,method:t})}return e}function i(t){return new Promise(function(n,e){if(s.isEntity(t))null==t.id?t.save().then(function(){n(t.href())})["catch"](function(t){e(t)}):n(t.href());else if(Array.isArray(t)){var r=[];for(var o in t)r.push(i(o));Promise.all(r).then(function(t){n(t)})["catch"](function(t){e(t)})}else if(null!=t&&t.constructor===Object){r=[];var a={},u=0;for(var c in t)t.hasOwnProperty(c)&&(a[u++]=c,r.push(i(t[c])));Promise.all(r).then(function(t){for(var e={},i=0;i<t.length;i++)e[a[i]]=t[i];n(e)})["catch"](function(t){e(t)})}else n(t)})}var r={},o={};o.config={globalFetchOptions:{},baseURL:"/",fetchStartHook:null,fetchEndHook:null},n.prototype.queryParam=function(t){if(null!=t){var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(e+"="+t[e]);this.options.url=this.options.url.split("?")[0]+"?"+n.join("&")}return this},n.prototype.jsonBody=function(t){return this.options.body=JSON.stringify(t),this.options.headers["Content-Type"]="application/json",this},n.prototype.formBody=function(t){var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(e+"="+t[e]);return this.options.body=n.join("&"),this.options.headers["Content-Type"]="application/x-www-form-urlencoded",this},n.prototype.send=function(){var n=this;return new Promise(function(e,i){if(n.hasSend)n.error?i(n):e(n.responseData);else{n.hasSend=!0;var r=o.config.fetchStartHook,s=o.config.fetchEndHook;r&&r(n),t(n.options.url,n.options).then(function(t){n.response=t;var e=t.headers.get("content-type");return null==e?Promise.resolve():/.*json.*/.test(e)?t.json():t.text()}).then(function(t){return n.responseData=t,n.response.ok?Promise.resolve(t):Promise.reject(t)}).then(function(t){s&&s(n),e(t)})["catch"](function(t){n.error=t,s&&s(n),i(n)})}})},n.prototype.then=function(t,n){return this.send().then(t)["catch"](n)},n.prototype.follow=function(t){var n=this;return new Promise(function(e,i){function r(s){var a=t.shift();if(a){var u=s._links,c=u[a];c?(c=c.href,o.get(c).send().then(function(t){r(t)})["catch"](function(t){i(t)})):(n.error="no key="+a+" \nin links="+JSON.stringify(u,null,4),i(n))}else e(s)}n.send().then(function(t){r(t)})["catch"](function(t){i(t)})})},o.get=e("GET"),o.post=e("POST"),o.patch=e("PATCH"),o.put=e("PUT"),o["delete"]=e("DELETE"),o.mockRequest=function(t){var e=t._links.self.href,i=new n({url:e,method:"GET"});return i.responseData=t,i.hasSend=!0,i},r.request=o;var s={};return s.config={restBaseURL:"/"},s.isEntity=function(t){if(t){var n=t.href;return null!=n&&n.constructor===Function}return!1},s.extend=function(t){function n(t){var e=this;this.id=null,this._data={},this._modifyFileds=[],this.href=function(){var t;if(e._data&&(t=e._data._links),t)return t.self.href;if(e.id)return e.constructor.entityBaseURL+"/"+e.id;throw new Error("entity without id can't map to backend service:\n"+JSON.stringify(e))},this.get=function(t){return e._data[t]},this.set=function(t,n){this._modifyFileds.push(t),this._data[t]=n},this.data=function(){return e._data},this.patchData=function(t){for(var n in t)t.hasOwnProperty(n)&&this.set(n,t[n]);try{var i=t._links.self.href.split(/\//);i=i[i.length-1],null!=i&&(e.id=i)}catch(r){}},this._create=function(){return new Promise(function(t,n){i(e.data()).then(function(t){return o.post(e.constructor.entityBaseURL).jsonBody(t).send()}).then(function(n){e.patchData(n),t(n)})["catch"](function(t){n(t)})})},this._update=function(){for(var t={},n=this._data._links,a=[],u=0;u<e._modifyFileds.length;u++){var c=e._modifyFileds[u];if(!t.hasOwnProperty(c)&&"_"!==c[0]){var f=this.get(c);if(n[c]&&(s.isEntity(f)||Array.isArray(f)&&s.isEntity(f[0]))){f=i(f);var h=o.put(n[c].href).jsonBody(f);h.options.headers["Content-Type"]="text/uri-list",a.push(h.data())}else t[c]=f}}return new Promise(function(n,o){i(t).then(function(t){return a.unshift(r.request.patch(e.href()).jsonBody(t).send()),Promise.all(a)}).then(function(t){var i=t[0];e.patchData(i),n(i)})["catch"](function(t){o(t)})})},this.save=function(){return null!=e.id?e._update():e._create()},this["delete"]=function(){return n["delete"](e.id)},this.fetch=function(){return new Promise(function(t,i){n.findOne(e.id).then(function(n){var i=n.data();e.patchData(i),t(i)})["catch"](function(t){i(t)})})},this.follow=function(t){return new Promise(function(n,i){function r(){o.mockRequest(e._data).follow(t).then(function(t){n(t)})["catch"](function(t){i(t)})}e._modifyFileds.length>0?r():e.fetch().then(function(){r()})})},this.patchData(t)}function e(t){for(var e=[],i=t._embedded[n.entityName],r=0;r<i.length;r++)e.push(new n(i[r]));return e}return n.entityName=t,n.entityBaseURL=s.config.restBaseURL+"/"+n.entityName,n.findOne=function(t,e){if(t)return new Promise(function(i,r){o.get(n.entityBaseURL+"/"+t).queryParam(e).send().then(function(t){i(new n(t))})["catch"](function(t){r(t)})});throw new Error("require id")},n.findAll=function(t){return new Promise(function(i,r){o.get(n.entityBaseURL).queryParam(t).send().then(function(t){var n=e(t);n.page=t.page,i(n)})["catch"](function(t){r(t)})})},n.search=function(t,i){return new Promise(function(r,s){o.get(n.entityBaseURL+"/search/"+t).queryParam(i).send().then(function(t){try{r(e(t))}catch(i){r(new n(t))}})["catch"](function(t){s(t)})})},n["delete"]=function(t){return o["delete"](n.entityBaseURL+"/"+t).send()},n},r.entity=s,r}if("object"==typeof exports&&"undefined"==typeof window)module.exports=_spring;else{var spring=_spring(window.fetch);"object"==typeof module&&(module.exports=spring)}
//# sourceMappingURL=dist/spring-data-rest.min.js.map