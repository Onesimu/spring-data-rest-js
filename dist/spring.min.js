!function(g){function I(A){if(C[A])return C[A].exports;var n=C[A]={i:A,l:!1,exports:{}};return g[A].call(n.exports,n,n.exports,I),n.l=!0,n.exports}var C={};return I.m=g,I.c=C,I.i=function(g){return g},I.d=function(g,I,C){Object.defineProperty(g,I,{configurable:!1,enumerable:!0,get:C})},I.o=function(g,I){return Object.prototype.hasOwnProperty.call(g,I)},I.p="",I(I.s=5)}([/*!********************!*\
  !*** ./request.js ***!
  \********************/
function(module,exports){"use strict";eval("\"use strict\";\nfunction buildHttpMethodFunction(method) {\n    /**\n     * make http request user fetch API.\n     * if path param is a complete url then fetch ues path as url,\n     * else path is not a complete url string but just a path then fetch url=requestConfig.baseURL+path\n     * url string will been auto revised, etc: http://localhost/api//user///id/ will convert to http://localhost/api/user/id\n     * @param path url path\n     */\n    function httpRequest(path) {\n        var url = path;\n        if (!/^https?:\\/\\/.+$/g.test(path)) {\n            url = exports.requestConfig.baseURL + '/' + path;\n        }\n        url = url.replace(/\\/{2,}/g, '/').replace(/:\\//g, '://');\n        return new Request({ url: url, method: method });\n    }\n    return httpRequest;\n}\nvar Request = (function () {\n    /**\n     * @param fetchOptions\n     */\n    function Request(fetchOptions) {\n        /**\n         * store fetch options\n         */\n        this.options = {\n            headers: {}\n        };\n        /**\n         * has this request been send\n         */\n        this.hasSend = false;\n        /**\n         * The Response interface of the Fetch API represents the response to a request.\n         * @see https://developer.mozilla.org/en-US/docs/Web/API/Response\n         */\n        this.response = null;\n        /**\n         * if error happen during request error will store in there,else this will be null\n         */\n        this.error = null;\n        Object.assign(this.options, exports.requestConfig.globalFetchOptions, fetchOptions);\n    }\n    /**\n     * reset query param in request url by append ? and query param to end of url\n     * @param obj\n     */\n    Request.prototype.queryParam = function (obj) {\n        if (obj != null) {\n            var arr = [];\n            for (var key in obj) {\n                if (obj.hasOwnProperty(key)) {\n                    arr.push(key + \"=\" + obj[key]);\n                }\n            }\n            this.options.url = this.options.url.split('?')[0] + '?' + arr.join('&');\n        }\n        return this;\n    };\n    /**\n     * set request body use json\n     * HTTP Header Content-Type will set as application/json\n     * @param obj\n     */\n    Request.prototype.jsonBody = function (obj) {\n        this.options.body = JSON.stringify(obj);\n        this.options.headers['Content-Type'] = 'application/json';\n        return this;\n    };\n    /**\n     * set request body as form type\n     * parse obj to form string\n     * HTTP Header Content-Type will set as application/x-www-form-urlencoded\n     * @param obj\n     */\n    Request.prototype.formBody = function (obj) {\n        var arr = [];\n        for (var key in obj) {\n            if (obj.hasOwnProperty(key)) {\n                arr.push(key + \"=\" + obj[key]);\n            }\n        }\n        this.options.body = arr.join('&');\n        this.options.headers['Content-Type'] = 'application/x-www-form-urlencoded';\n        return this;\n    };\n    /**\n     * send fetch request\n     * get response's data\n     * resolve:\n     *      if response content-type is null,then resolve null\n     *      if response content-type has string json,then read response data as json and resolve pure json\n     *      else read response data as text and resolve plain text\n     */\n    Request.prototype.send = function () {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            if (_this.hasSend) {\n                if (_this.error == null) {\n                    resolve(_this.responseData);\n                }\n                else {\n                    reject(_this.error);\n                }\n            }\n            else {\n                _this.hasSend = true;\n                var fetchStartHook = exports.requestConfig.fetchStartHook, fetchEndHook_1 = exports.requestConfig.fetchEndHook;\n                fetchStartHook && fetchStartHook(_this);\n                fetch(_this.options.url, _this.options).then(function (response) {\n                    _this.response = response;\n                    var contentType = response.headers.get('content-type');\n                    if (contentType == null) {\n                        return Promise.resolve();\n                    }\n                    else {\n                        if (/.*json.*/.test(contentType)) {\n                            //noinspection JSUnresolvedFunction\n                            return response.json();\n                        }\n                        else {\n                            return response.text();\n                        }\n                    }\n                }).then(function (data) {\n                    _this.responseData = data;\n                    if (_this.response.ok) {\n                        return Promise.resolve(data);\n                    }\n                    else {\n                        return Promise.reject(data);\n                    }\n                }).then(function (data) {\n                    fetchEndHook_1 && fetchEndHook_1(_this);\n                    resolve(data);\n                }).catch(function (err) {\n                    _this.error = err;\n                    fetchEndHook_1 && fetchEndHook_1(_this);\n                    reject(_this);\n                });\n            }\n        });\n    };\n    /**\n     * send request follow _links's href\n     * resolve:\n     *      if response content-type is null,then resolve null\n     *      if response content-type has string json,then read response data as json and resolve pure json\n     *      else read response data as text and resolve plain text\n     */\n    Request.prototype.follow = function (keys) {\n        var _this = this;\n        var self = this;\n        return new Promise(function (resolve, reject) {\n            function doFollow(data) {\n                var key = keys.shift();\n                if (key) {\n                    var links = data['_links'];\n                    var url = links[key];\n                    if (url != null) {\n                        url = url['href'];\n                        exports.get(url).send().then(function (data) {\n                            doFollow(data);\n                        }).catch(function (self) {\n                            reject(self);\n                        });\n                    }\n                    else {\n                        self.error = \"no key=\" + key + \" in links \" + JSON.stringify(links, null, 4);\n                        reject(this);\n                    }\n                }\n                else {\n                    resolve(data);\n                }\n            }\n            _this.send().then(function (data) {\n                doFollow(data);\n            }).catch(function (self) {\n                reject(self);\n            });\n        });\n    };\n    return Request;\n}());\nexports.Request = Request;\nexports.requestConfig = {\n    globalFetchOptions: {},\n    baseURL: '/',\n    fetchStartHook: null,\n    fetchEndHook: null\n};\n/**\n * make http get request\n * @param path url path\n */\nexports.get = buildHttpMethodFunction('GET');\n/**\n * make http post request\n * @param path url path\n */\nexports.post = buildHttpMethodFunction('POST');\n/**\n * make http patch request\n * @param path url path\n */\nexports.patch = buildHttpMethodFunction('PATCH');\n/**\n * make http put request\n * @param path url path\n */\nexports.put = buildHttpMethodFunction('PUT');\n//noinspection ReservedWordAsName\n/**\n * make http remove request\n * @param path url path\n */\nexports.deleteMethod = buildHttpMethodFunction('DELETE');\n/**\n * mockRequest a request with data\n * @param {object} data\n */\nfunction mockRequest(data) {\n    var url = data['_links']['self']['href'];\n    var req = new Request({ url: url, method: 'GET' });\n    req.responseData = data;\n    req.hasSend = true;\n    return req;\n}\nexports.mockRequest = mockRequest;\n//# sourceMappingURL=request.js.map//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3JlcXVlc3QuanM/YzYxZSJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbmZ1bmN0aW9uIGJ1aWxkSHR0cE1ldGhvZEZ1bmN0aW9uKG1ldGhvZCkge1xuICAgIC8qKlxuICAgICAqIG1ha2UgaHR0cCByZXF1ZXN0IHVzZXIgZmV0Y2ggQVBJLlxuICAgICAqIGlmIHBhdGggcGFyYW0gaXMgYSBjb21wbGV0ZSB1cmwgdGhlbiBmZXRjaCB1ZXMgcGF0aCBhcyB1cmwsXG4gICAgICogZWxzZSBwYXRoIGlzIG5vdCBhIGNvbXBsZXRlIHVybCBzdHJpbmcgYnV0IGp1c3QgYSBwYXRoIHRoZW4gZmV0Y2ggdXJsPXJlcXVlc3RDb25maWcuYmFzZVVSTCtwYXRoXG4gICAgICogdXJsIHN0cmluZyB3aWxsIGJlZW4gYXV0byByZXZpc2VkLCBldGM6IGh0dHA6Ly9sb2NhbGhvc3QvYXBpLy91c2VyLy8vaWQvIHdpbGwgY29udmVydCB0byBodHRwOi8vbG9jYWxob3N0L2FwaS91c2VyL2lkXG4gICAgICogQHBhcmFtIHBhdGggdXJsIHBhdGhcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBodHRwUmVxdWVzdChwYXRoKSB7XG4gICAgICAgIHZhciB1cmwgPSBwYXRoO1xuICAgICAgICBpZiAoIS9eaHR0cHM/OlxcL1xcLy4rJC9nLnRlc3QocGF0aCkpIHtcbiAgICAgICAgICAgIHVybCA9IGV4cG9ydHMucmVxdWVzdENvbmZpZy5iYXNlVVJMICsgJy8nICsgcGF0aDtcbiAgICAgICAgfVxuICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgvXFwvezIsfS9nLCAnLycpLnJlcGxhY2UoLzpcXC8vZywgJzovLycpO1xuICAgICAgICByZXR1cm4gbmV3IFJlcXVlc3QoeyB1cmw6IHVybCwgbWV0aG9kOiBtZXRob2QgfSk7XG4gICAgfVxuICAgIHJldHVybiBodHRwUmVxdWVzdDtcbn1cbnZhciBSZXF1ZXN0ID0gKGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gZmV0Y2hPcHRpb25zXG4gICAgICovXG4gICAgZnVuY3Rpb24gUmVxdWVzdChmZXRjaE9wdGlvbnMpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHN0b3JlIGZldGNoIG9wdGlvbnNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHt9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBoYXMgdGhpcyByZXF1ZXN0IGJlZW4gc2VuZFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5oYXNTZW5kID0gZmFsc2U7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgUmVzcG9uc2UgaW50ZXJmYWNlIG9mIHRoZSBGZXRjaCBBUEkgcmVwcmVzZW50cyB0aGUgcmVzcG9uc2UgdG8gYSByZXF1ZXN0LlxuICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9SZXNwb25zZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZXNwb25zZSA9IG51bGw7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBpZiBlcnJvciBoYXBwZW4gZHVyaW5nIHJlcXVlc3QgZXJyb3Igd2lsbCBzdG9yZSBpbiB0aGVyZSxlbHNlIHRoaXMgd2lsbCBiZSBudWxsXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmVycm9yID0gbnVsbDtcbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLm9wdGlvbnMsIGV4cG9ydHMucmVxdWVzdENvbmZpZy5nbG9iYWxGZXRjaE9wdGlvbnMsIGZldGNoT3B0aW9ucyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHJlc2V0IHF1ZXJ5IHBhcmFtIGluIHJlcXVlc3QgdXJsIGJ5IGFwcGVuZCA/IGFuZCBxdWVyeSBwYXJhbSB0byBlbmQgb2YgdXJsXG4gICAgICogQHBhcmFtIG9ialxuICAgICAqL1xuICAgIFJlcXVlc3QucHJvdG90eXBlLnF1ZXJ5UGFyYW0gPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIGlmIChvYmogIT0gbnVsbCkge1xuICAgICAgICAgICAgdmFyIGFyciA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIG9iaikge1xuICAgICAgICAgICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChrZXkgKyBcIj1cIiArIG9ialtrZXldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMudXJsID0gdGhpcy5vcHRpb25zLnVybC5zcGxpdCgnPycpWzBdICsgJz8nICsgYXJyLmpvaW4oJyYnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIHNldCByZXF1ZXN0IGJvZHkgdXNlIGpzb25cbiAgICAgKiBIVFRQIEhlYWRlciBDb250ZW50LVR5cGUgd2lsbCBzZXQgYXMgYXBwbGljYXRpb24vanNvblxuICAgICAqIEBwYXJhbSBvYmpcbiAgICAgKi9cbiAgICBSZXF1ZXN0LnByb3RvdHlwZS5qc29uQm9keSA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmJvZHkgPSBKU09OLnN0cmluZ2lmeShvYmopO1xuICAgICAgICB0aGlzLm9wdGlvbnMuaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vanNvbic7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogc2V0IHJlcXVlc3QgYm9keSBhcyBmb3JtIHR5cGVcbiAgICAgKiBwYXJzZSBvYmogdG8gZm9ybSBzdHJpbmdcbiAgICAgKiBIVFRQIEhlYWRlciBDb250ZW50LVR5cGUgd2lsbCBzZXQgYXMgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXG4gICAgICogQHBhcmFtIG9ialxuICAgICAqL1xuICAgIFJlcXVlc3QucHJvdG90eXBlLmZvcm1Cb2R5ID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgICB2YXIgYXJyID0gW107XG4gICAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHtcbiAgICAgICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgIGFyci5wdXNoKGtleSArIFwiPVwiICsgb2JqW2tleV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMub3B0aW9ucy5ib2R5ID0gYXJyLmpvaW4oJyYnKTtcbiAgICAgICAgdGhpcy5vcHRpb25zLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogc2VuZCBmZXRjaCByZXF1ZXN0XG4gICAgICogZ2V0IHJlc3BvbnNlJ3MgZGF0YVxuICAgICAqIHJlc29sdmU6XG4gICAgICogICAgICBpZiByZXNwb25zZSBjb250ZW50LXR5cGUgaXMgbnVsbCx0aGVuIHJlc29sdmUgbnVsbFxuICAgICAqICAgICAgaWYgcmVzcG9uc2UgY29udGVudC10eXBlIGhhcyBzdHJpbmcganNvbix0aGVuIHJlYWQgcmVzcG9uc2UgZGF0YSBhcyBqc29uIGFuZCByZXNvbHZlIHB1cmUganNvblxuICAgICAqICAgICAgZWxzZSByZWFkIHJlc3BvbnNlIGRhdGEgYXMgdGV4dCBhbmQgcmVzb2x2ZSBwbGFpbiB0ZXh0XG4gICAgICovXG4gICAgUmVxdWVzdC5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIGlmIChfdGhpcy5oYXNTZW5kKSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmVycm9yID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShfdGhpcy5yZXNwb25zZURhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KF90aGlzLmVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5oYXNTZW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2YXIgZmV0Y2hTdGFydEhvb2sgPSBleHBvcnRzLnJlcXVlc3RDb25maWcuZmV0Y2hTdGFydEhvb2ssIGZldGNoRW5kSG9va18xID0gZXhwb3J0cy5yZXF1ZXN0Q29uZmlnLmZldGNoRW5kSG9vaztcbiAgICAgICAgICAgICAgICBmZXRjaFN0YXJ0SG9vayAmJiBmZXRjaFN0YXJ0SG9vayhfdGhpcyk7XG4gICAgICAgICAgICAgICAgZmV0Y2goX3RoaXMub3B0aW9ucy51cmwsIF90aGlzLm9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnJlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50VHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdjb250ZW50LXR5cGUnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnRUeXBlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgvLipqc29uLiovLnRlc3QoY29udGVudFR5cGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9ub2luc3BlY3Rpb24gSlNVbnJlc29sdmVkRnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVzcG9uc2VEYXRhID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLnJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBmZXRjaEVuZEhvb2tfMSAmJiBmZXRjaEVuZEhvb2tfMShfdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5lcnJvciA9IGVycjtcbiAgICAgICAgICAgICAgICAgICAgZmV0Y2hFbmRIb29rXzEgJiYgZmV0Y2hFbmRIb29rXzEoX3RoaXMpO1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoX3RoaXMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIHNlbmQgcmVxdWVzdCBmb2xsb3cgX2xpbmtzJ3MgaHJlZlxuICAgICAqIHJlc29sdmU6XG4gICAgICogICAgICBpZiByZXNwb25zZSBjb250ZW50LXR5cGUgaXMgbnVsbCx0aGVuIHJlc29sdmUgbnVsbFxuICAgICAqICAgICAgaWYgcmVzcG9uc2UgY29udGVudC10eXBlIGhhcyBzdHJpbmcganNvbix0aGVuIHJlYWQgcmVzcG9uc2UgZGF0YSBhcyBqc29uIGFuZCByZXNvbHZlIHB1cmUganNvblxuICAgICAqICAgICAgZWxzZSByZWFkIHJlc3BvbnNlIGRhdGEgYXMgdGV4dCBhbmQgcmVzb2x2ZSBwbGFpbiB0ZXh0XG4gICAgICovXG4gICAgUmVxdWVzdC5wcm90b3R5cGUuZm9sbG93ID0gZnVuY3Rpb24gKGtleXMpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgZnVuY3Rpb24gZG9Gb2xsb3coZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBrZXlzLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGlua3MgPSBkYXRhWydfbGlua3MnXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IGxpbmtzW2tleV07XG4gICAgICAgICAgICAgICAgICAgIGlmICh1cmwgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsWydocmVmJ107XG4gICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRzLmdldCh1cmwpLnNlbmQoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9Gb2xsb3coZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoc2VsZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChzZWxmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5lcnJvciA9IFwibm8ga2V5PVwiICsga2V5ICsgXCIgaW4gbGlua3MgXCIgKyBKU09OLnN0cmluZ2lmeShsaW5rcywgbnVsbCwgNCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMuc2VuZCgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBkb0ZvbGxvdyhkYXRhKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChzZWxmKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KHNlbGYpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIFJlcXVlc3Q7XG59KCkpO1xuZXhwb3J0cy5SZXF1ZXN0ID0gUmVxdWVzdDtcbmV4cG9ydHMucmVxdWVzdENvbmZpZyA9IHtcbiAgICBnbG9iYWxGZXRjaE9wdGlvbnM6IHt9LFxuICAgIGJhc2VVUkw6ICcvJyxcbiAgICBmZXRjaFN0YXJ0SG9vazogbnVsbCxcbiAgICBmZXRjaEVuZEhvb2s6IG51bGxcbn07XG4vKipcbiAqIG1ha2UgaHR0cCBnZXQgcmVxdWVzdFxuICogQHBhcmFtIHBhdGggdXJsIHBhdGhcbiAqL1xuZXhwb3J0cy5nZXQgPSBidWlsZEh0dHBNZXRob2RGdW5jdGlvbignR0VUJyk7XG4vKipcbiAqIG1ha2UgaHR0cCBwb3N0IHJlcXVlc3RcbiAqIEBwYXJhbSBwYXRoIHVybCBwYXRoXG4gKi9cbmV4cG9ydHMucG9zdCA9IGJ1aWxkSHR0cE1ldGhvZEZ1bmN0aW9uKCdQT1NUJyk7XG4vKipcbiAqIG1ha2UgaHR0cCBwYXRjaCByZXF1ZXN0XG4gKiBAcGFyYW0gcGF0aCB1cmwgcGF0aFxuICovXG5leHBvcnRzLnBhdGNoID0gYnVpbGRIdHRwTWV0aG9kRnVuY3Rpb24oJ1BBVENIJyk7XG4vKipcbiAqIG1ha2UgaHR0cCBwdXQgcmVxdWVzdFxuICogQHBhcmFtIHBhdGggdXJsIHBhdGhcbiAqL1xuZXhwb3J0cy5wdXQgPSBidWlsZEh0dHBNZXRob2RGdW5jdGlvbignUFVUJyk7XG4vL25vaW5zcGVjdGlvbiBSZXNlcnZlZFdvcmRBc05hbWVcbi8qKlxuICogbWFrZSBodHRwIHJlbW92ZSByZXF1ZXN0XG4gKiBAcGFyYW0gcGF0aCB1cmwgcGF0aFxuICovXG5leHBvcnRzLmRlbGV0ZU1ldGhvZCA9IGJ1aWxkSHR0cE1ldGhvZEZ1bmN0aW9uKCdERUxFVEUnKTtcbi8qKlxuICogbW9ja1JlcXVlc3QgYSByZXF1ZXN0IHdpdGggZGF0YVxuICogQHBhcmFtIHtvYmplY3R9IGRhdGFcbiAqL1xuZnVuY3Rpb24gbW9ja1JlcXVlc3QoZGF0YSkge1xuICAgIHZhciB1cmwgPSBkYXRhWydfbGlua3MnXVsnc2VsZiddWydocmVmJ107XG4gICAgdmFyIHJlcSA9IG5ldyBSZXF1ZXN0KHsgdXJsOiB1cmwsIG1ldGhvZDogJ0dFVCcgfSk7XG4gICAgcmVxLnJlc3BvbnNlRGF0YSA9IGRhdGE7XG4gICAgcmVxLmhhc1NlbmQgPSB0cnVlO1xuICAgIHJldHVybiByZXE7XG59XG5leHBvcnRzLm1vY2tSZXF1ZXN0ID0gbW9ja1JlcXVlc3Q7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1yZXF1ZXN0LmpzLm1hcFxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vcmVxdWVzdC5qc1xuLy8gbW9kdWxlIGlkID0gMFxuLy8gbW9kdWxlIGNodW5rcyA9IDAgMSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==")},/*!******************!*\
  !*** ./index.js ***!
  \******************/
function(module,exports,__webpack_require__){"use strict";eval('"use strict";\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\n__export(__webpack_require__(/*! ./request */ 0));\n__export(__webpack_require__(/*! ./entity */ 3));\n//# sourceMappingURL=index.js.map//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2luZGV4LmpzPzI2NDUiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5mdW5jdGlvbiBfX2V4cG9ydChtKSB7XG4gICAgZm9yICh2YXIgcCBpbiBtKSBpZiAoIWV4cG9ydHMuaGFzT3duUHJvcGVydHkocCkpIGV4cG9ydHNbcF0gPSBtW3BdO1xufVxuX19leHBvcnQocmVxdWlyZSgnLi9yZXF1ZXN0JykpO1xuX19leHBvcnQocmVxdWlyZSgnLi9lbnRpdHknKSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXBcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2luZGV4LmpzXG4vLyBtb2R1bGUgaWQgPSAxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=')},/*!********************!*\
  !*** ./browser.js ***!
  \********************/
function(module,exports,__webpack_require__){"use strict";eval("\"use strict\";\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nvar spring = __webpack_require__(/*! ./index */ 1);\nwindow['spring'] = spring;\n__export(__webpack_require__(/*! ./index */ 1));\n//# sourceMappingURL=browser.js.map//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2Jyb3dzZXIuanM/ODU0MCJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbmZ1bmN0aW9uIF9fZXhwb3J0KG0pIHtcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmICghZXhwb3J0cy5oYXNPd25Qcm9wZXJ0eShwKSkgZXhwb3J0c1twXSA9IG1bcF07XG59XG52YXIgc3ByaW5nID0gcmVxdWlyZSgnLi9pbmRleCcpO1xud2luZG93WydzcHJpbmcnXSA9IHNwcmluZztcbl9fZXhwb3J0KHJlcXVpcmUoJy4vaW5kZXgnKSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1icm93c2VyLmpzLm1hcFxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYnJvd3Nlci5qc1xuLy8gbW9kdWxlIGlkID0gMlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=")},/*!*******************!*\
  !*** ./entity.js ***!
  \*******************/
function(module,exports,__webpack_require__){"use strict";eval("\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar request = __webpack_require__(/*! ./request */ 0);\nexports.entityConfig = {\n    restBaseURL: '/'\n};\n/**\n * any is an instanceof Entity\n * @param any\n * @returns {boolean}\n */\nfunction isEntity(any) {\n    if (any instanceof Object) {\n        var prototype = any.constructor.prototype.__proto__;\n        while (prototype instanceof Object) {\n            if (prototype.constructor === Entity) {\n                return true;\n            }\n            else {\n                prototype = prototype.__proto__;\n            }\n        }\n    }\n    return false;\n}\nexports.isEntity = isEntity;\n/**\n * object deep equal,optimize for Entity\n * @param a\n * @param b\n * @returns {boolean} is equal ?\n */\nfunction equal(a, b) {\n    if (typeof a === typeof b) {\n        if (isEntity(a) && isEntity(b)) {\n            if (a.id == b.id) {\n                return true;\n            }\n            else {\n                return equal(a.data(), b.data());\n            }\n        }\n        else if (Array.isArray(a) && Array.isArray(b)) {\n            if (a.length === b.length) {\n                var re_1 = true;\n                a.forEach(function (aV, i) {\n                    re_1 = re_1 && equal(aV, b[i]);\n                });\n                return re_1;\n            }\n        }\n        else if ((a instanceof Object) && (b instanceof Object)) {\n            for (var key in a) {\n                var re = true;\n                if (a.hasOwnProperty(key) && b.hasOwnProperty(key)) {\n                    re = re && equal(a[key], b[key]);\n                }\n                else {\n                    return false;\n                }\n            }\n        }\n        else {\n            return a == b;\n        }\n    }\n    return false;\n}\nexports.equal = equal;\nvar Entity = (function () {\n    /**\n     * mock an entity instance with init data\n     * @param initData\n     */\n    function Entity(initData) {\n        /**\n         * store one entity's data\n         */\n        this._data = {};\n        /**\n         * track modify field\n         */\n        this.modifyFields = [];\n        this.patchData(initData);\n    }\n    /**\n     * get this entity's spring data rest resource uri.\n     * if this entity's has data and data has _link properties,use _data['_links']['self']['href']\n     * else use config.restBaseURL + entityName + '/' + self.id\n     */\n    Entity.prototype.href = function () {\n        var links = this._data['_links'];\n        if (links != null) {\n            return links['self']['href'];\n        }\n        else {\n            if (this.id) {\n                return this.constructor.entityBaseURL() + \"/\" + this.id;\n            }\n            else {\n                throw new Error(\"entity without id can't map to backend service:\\n\" + JSON.stringify(this));\n            }\n        }\n    };\n    /**\n     * get entity properties value by key\n     * @param key properties name\n     */\n    Entity.prototype.get = function (key) {\n        return this._data[key];\n    };\n    /**\n     * set entity properties value by key\n     * will compare olaValue and newValue,if value is equal then not append filed name to modifyFields\n     * @param key properties name\n     * @param value\n     */\n    Entity.prototype.set = function (key, value) {\n        var oldValue = this.get(key);\n        if (!equal(oldValue, value)) {\n            this.modifyFields.push(key);\n        }\n        this._data[key] = value;\n    };\n    /**\n     * get entity data ref\n     */\n    Entity.prototype.data = function () {\n        return this._data;\n    };\n    /**\n     * assign a patchData object to entity's properties\n     * if patchData has self link, then id will update by parseIdFromData\n     * @param patchData\n     */\n    Entity.prototype.patchData = function (patchData) {\n        for (var key in patchData) {\n            if (patchData.hasOwnProperty(key)) {\n                this.set(key, patchData[key]);\n            }\n        }\n        try {\n            var id = patchData['_links']['self']['href'].split(/\\//);\n            id = id[id.length - 1];\n            if (id != null) {\n                this.id = id;\n            }\n        }\n        catch (_) {\n        }\n    };\n    /**\n     * create an new entity\n     * send HTTP POST request to create an entity\n     */\n    Entity.prototype.create = function () {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            _this.constructor.translateRelationEntity(_this.data()).then(function (body) {\n                return request.post(_this.constructor.entityBaseURL()).jsonBody(body).send();\n            }).then(function (json) {\n                _this.patchData(json);\n                _this.modifyFields = [];\n                resolve(json);\n            }).catch(function (err) {\n                reject(err);\n            });\n        });\n    };\n    /**\n     * update an entity\n     * send HTTP PATCH request to update an entity(will watch change in data properties to track change fields)\n     * @returns {Promise} resolve(json), reject(Request)\n     * @private\n     */\n    Entity.prototype.update = function () {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            var pureChange = {};\n            if (_this.modifyFields.length == 0) {\n                resolve();\n                return;\n            }\n            _this.modifyFields.forEach(function (key) {\n                if (pureChange.hasOwnProperty(key) || key[0] === '_') {\n                    return;\n                }\n                else if (_this._data.hasOwnProperty(key)) {\n                    pureChange[key] = _this.get(key);\n                }\n            });\n            _this.constructor.translateRelationEntity(pureChange).then(function (json) {\n                return request.patch(_this.href()).jsonBody(json).send();\n            }).then(function (json) {\n                _this.patchData(json);\n                _this.modifyFields = [];\n                resolve(json);\n            }).catch(function (err) {\n                reject(err);\n            });\n        });\n    };\n    /**\n     * create or update entity\n     * if id properties is set update change to service,\n     * else create an new entity to service.\n     *\n     * if entity.properties is an instance of Entity or Entity[],then entity.properties.save() will also call,which mean entity's all Entity attr will auto save()\n     */\n    Entity.prototype.save = function () {\n        if (this.id != null) {\n            return this.update();\n        }\n        else {\n            return this.create();\n        }\n    };\n    /**\n     * remove this entity\n     */\n    Entity.prototype.remove = function () {\n        return this.constructor.remove(this.id);\n    };\n    /**\n     * fetch entity data to keep updated to newest\n     * @returns {Promise} resolve(json), reject(Request)\n     */\n    Entity.prototype.fetch = function () {\n        var _this = this;\n        return new Promise(function (resole, reject) {\n            _this.constructor.findOne(_this.id).then(function (entity) {\n                var json = entity.data();\n                _this.patchData(json);\n                _this.modifyFields = [];\n                resole(json);\n            }).catch(function (err) {\n                reject(err);\n            });\n        });\n    };\n    /**\n     * send request follow this entity's _links's href\n     * @param {string[]} keys links href in order\n     * @returns {Promise} resolve(json), reject(Request)\n     */\n    Entity.prototype.follow = function (keys) {\n        var _this = this;\n        return new Promise(function (resole, reject) {\n            function doFollow(data) {\n                request.mockRequest(data).follow(keys).then(function (json) {\n                    resole(json);\n                }).catch(function (err) {\n                    reject(err);\n                });\n            }\n            //fetch data before doFollow\n            if (_this._data['_links'] != null) {\n                doFollow(_this.data());\n            }\n            else {\n                _this.fetch().then(function () {\n                    doFollow(_this.data());\n                });\n            }\n        });\n    };\n    /**\n     * fetch relation property and store response value in entity's data attr,relation property is an instance of Entity.\n     * after fetch you can get relation property by get(propertyName)\n     * @param propertyName Entity relation property name in _links\n     * @param T relation property's type(extend Entity class)\n     * @returns {Promise<T>} resolve Entity relation property instance\n     */\n    Entity.prototype.fetchProperty = function (propertyName, T) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            _this.follow([propertyName]).then(function (json) {\n                var entity = T.jsonToEntity(json);\n                _this.data()[propertyName] = entity;\n                resolve(entity);\n            }).catch(function (err) {\n                reject(err);\n            });\n        });\n    };\n    /**\n     * fetch relation property and store response value in entity's data attr,relation property is an Entity array\n     * after fetch you can get relation property by get(propertyName)\n     * @param propertyName Entity relation property name in _links\n     * @param T relation property's type(extend Entity class)\n     * @returns {Promise<T>}\n     */\n    Entity.prototype.fetchArrayProperty = function (propertyName, T) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            _this.follow([propertyName]).then(function (json) {\n                var entities = T.jsonToEntityList(json);\n                _this.data()[propertyName] = entities;\n                resolve(entities);\n            }).catch(function (err) {\n                reject(err);\n            });\n        });\n    };\n    /**\n     * spring data rest entity base url\n     */\n    Entity.entityBaseURL = function () {\n        return exports.entityConfig.restBaseURL + \"/\" + this.entityName;\n    };\n    /**\n     * read spring data rest's response json data then parse and return entity array\n     * @param json\n     */\n    Entity.jsonToEntityList = function (json) {\n        var _this = this;\n        var re = [];\n        var arr = json['_embedded'][this.entityName];\n        arr.forEach(function (json) {\n            re.push(_this.jsonToEntity(json));\n        });\n        re['page'] = json['page']; //add page info\n        return re;\n    };\n    /**\n     * read spring data rest's response json data then parse and return an entity\n     * @param json\n     */\n    Entity.jsonToEntity = function (json) {\n        var entity = new this(json);\n        //json data from server is fresh,so entity modifyFields should be empty\n        entity.modifyFields = [];\n        return entity;\n    };\n    /**\n     * this method use before send request to service to create or update entity\n     * translate entity's data properties which contain Relation Entity instance value to text-uri list\n     * if data has Entity attr,this Entity attr will be replace by is href() value,and if this entity has't be store in service will store this entity first.\n     * @param data entity's data properties can has Entity attr\n     *\n     * resolve: pure json data can send to spring data rest service as request body\n     * reject: Request with error prop\n     */\n    Entity.translateRelationEntity = function (data) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            if (isEntity(data)) {\n                data.save().then(function () {\n                    resolve(data.href());\n                }).catch(function (err) {\n                    reject(err);\n                });\n            }\n            else if (Array.isArray(data)) {\n                var promiseList_1 = [];\n                data.forEach(function (one) { return promiseList_1.push(_this.translateRelationEntity(one)); });\n                Promise.all(promiseList_1).then(function (arr) {\n                    resolve(arr);\n                }).catch(function (err) {\n                    reject(err);\n                });\n            }\n            else if (data != null && data.constructor === Object) {\n                var promiseList = [];\n                var indexKeyMap_1 = {};\n                var nowIndex = 0;\n                for (var key in data) {\n                    if (data.hasOwnProperty(key)) {\n                        indexKeyMap_1[nowIndex++] = key;\n                        promiseList.push(_this.translateRelationEntity(data[key]));\n                    }\n                }\n                Promise.all(promiseList).then(function (arr) {\n                    var json = {};\n                    for (var i = 0; i < arr.length; i++) {\n                        json[indexKeyMap_1[i]] = arr[i];\n                    }\n                    resolve(json);\n                }).catch(function (err) {\n                    reject(err);\n                });\n            }\n            else {\n                resolve(data);\n            }\n        });\n    };\n    /**\n     * get entity json data by id\n     * @param {string|number} id entity id\n     * @param {object?} queryParam\n     * @param {string} queryParam.projection the name of the projection you set with @Projection annotation name attributes\n     */\n    Entity.findOne = function (id, queryParam) {\n        var _this = this;\n        if (id != null) {\n            return new Promise(function (resolve, reject) {\n                request.get(_this.entityBaseURL() + \"/\" + id).queryParam(queryParam).send().then(function (json) {\n                    resolve(_this.jsonToEntity(json));\n                }).catch(function (err) {\n                    reject(err);\n                });\n            });\n        }\n        else {\n            throw new Error('require id');\n        }\n    };\n    /**\n     * collection resource with page and sort.\n     * Returns all entities the repository servers through its findAll(…) method. If the repository is a paging repository we include the pagination links if necessary and additional page metadata.*\n     * @param {object} queryParam\n     * @param {number} queryParam.page the page number to access (0 indexed, defaults to 0).\n     * @param {number} queryParam.size the page size requested (defaults to 20).\n     * @param {string} queryParam.sort a collection of sort directives in the format ($propertyName,)+[asc|desc]?\n     * etc:name,age,desc\n     */\n    Entity.findAll = function (queryParam) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            request.get(_this.entityBaseURL()).queryParam(queryParam).send().then(function (json) {\n                var re = _this.jsonToEntityList(json);\n                resolve(re);\n            }).catch(function (err) {\n                reject(err);\n            });\n        });\n    };\n    /**\n     * search resource if the backing repository exposes query methods.\n     * call query methods exposed by a repository. The path and name of the query method resources can be modified using @RestResource on the method declaration.\n     *\n     * @param {string} searchPath spring data rest searchMethod path string\n     *\n     * @param {Object} queryParam search params\n     * If the query method has pagination capabilities (indicated in the URI template pointing to the resource) the resource takes the following parameters:\n     * @param {number} queryParam.page the page number to access (0 indexed, defaults to 0).\n     * @param {number} queryParam.size the page size requested (defaults to 20).\n     * @param {string} queryParam.sort a collection of sort directives in the format ($propertyName,)+[asc|desc]?\n     *\n     * @returns {Promise} resolve(Entity|Entity[]) reject(Request)\n     * resolve:\n     *      if response json data has _embedded attr then resolve Entity array,\n     *      else resolve one Entity\n     */\n    Entity.search = function (searchPath, queryParam) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            request.get(_this.entityBaseURL() + \"/search/\" + searchPath).queryParam(queryParam).send().then(function (json) {\n                try {\n                    resolve(_this.jsonToEntityList(json));\n                }\n                catch (_) {\n                    resolve(_this.jsonToEntity(json));\n                }\n            }).catch(function (err) {\n                reject(err);\n            });\n        });\n    };\n    /**\n     * remove entity by id\n     */\n    Entity.remove = function (id) {\n        return request.deleteMethod(this.entityBaseURL() + \"/\" + id).send();\n    };\n    /**\n     * expose entity instance properties in _data to entity itself use Object.defineProperty getter and setter\n     * after expose,you can access property in entity by entity.property rather than access by entity.data().property\n     * @param propertyName property name in entity.data() object.\n     */\n    Entity.exposeProperty = function (propertyName) {\n        Object.defineProperty(this.prototype, propertyName, {\n            get: function () {\n                return this.get(propertyName);\n            },\n            set: function (value) {\n                this.set(propertyName, value);\n            },\n            enumerable: true\n        });\n    };\n    return Entity;\n}());\nexports.Entity = Entity;\n/**\n * build an Entity Entity\n * @param entity_name spring data rest entity path\n */\nfunction extend(entity_name) {\n    var Class = (function (_super) {\n        __extends(Class, _super);\n        function Class() {\n            _super.apply(this, arguments);\n        }\n        return Class;\n    }(Entity));\n    /**\n     * spring data rest entity path\n     */\n    Class.entityName = entity_name;\n    return Class;\n}\nexports.extend = extend;\n//# sourceMappingURL=entity.js.map//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2VudGl0eS5qcz9kMDNmIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCBmdW5jdGlvbiAoZCwgYikge1xuICAgIGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdO1xuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbn07XG52YXIgcmVxdWVzdCA9IHJlcXVpcmUoJy4vcmVxdWVzdCcpO1xuZXhwb3J0cy5lbnRpdHlDb25maWcgPSB7XG4gICAgcmVzdEJhc2VVUkw6ICcvJ1xufTtcbi8qKlxuICogYW55IGlzIGFuIGluc3RhbmNlb2YgRW50aXR5XG4gKiBAcGFyYW0gYW55XG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gaXNFbnRpdHkoYW55KSB7XG4gICAgaWYgKGFueSBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICB2YXIgcHJvdG90eXBlID0gYW55LmNvbnN0cnVjdG9yLnByb3RvdHlwZS5fX3Byb3RvX187XG4gICAgICAgIHdoaWxlIChwcm90b3R5cGUgaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICAgICAgICAgIGlmIChwcm90b3R5cGUuY29uc3RydWN0b3IgPT09IEVudGl0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcHJvdG90eXBlID0gcHJvdG90eXBlLl9fcHJvdG9fXztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5leHBvcnRzLmlzRW50aXR5ID0gaXNFbnRpdHk7XG4vKipcbiAqIG9iamVjdCBkZWVwIGVxdWFsLG9wdGltaXplIGZvciBFbnRpdHlcbiAqIEBwYXJhbSBhXG4gKiBAcGFyYW0gYlxuICogQHJldHVybnMge2Jvb2xlYW59IGlzIGVxdWFsID9cbiAqL1xuZnVuY3Rpb24gZXF1YWwoYSwgYikge1xuICAgIGlmICh0eXBlb2YgYSA9PT0gdHlwZW9mIGIpIHtcbiAgICAgICAgaWYgKGlzRW50aXR5KGEpICYmIGlzRW50aXR5KGIpKSB7XG4gICAgICAgICAgICBpZiAoYS5pZCA9PSBiLmlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZXF1YWwoYS5kYXRhKCksIGIuZGF0YSgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KGEpICYmIEFycmF5LmlzQXJyYXkoYikpIHtcbiAgICAgICAgICAgIGlmIChhLmxlbmd0aCA9PT0gYi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVfMSA9IHRydWU7XG4gICAgICAgICAgICAgICAgYS5mb3JFYWNoKGZ1bmN0aW9uIChhViwgaSkge1xuICAgICAgICAgICAgICAgICAgICByZV8xID0gcmVfMSAmJiBlcXVhbChhViwgYltpXSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlXzE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoKGEgaW5zdGFuY2VvZiBPYmplY3QpICYmIChiIGluc3RhbmNlb2YgT2JqZWN0KSkge1xuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmIChhLmhhc093blByb3BlcnR5KGtleSkgJiYgYi5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlID0gcmUgJiYgZXF1YWwoYVtrZXldLCBiW2tleV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBhID09IGI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuZXhwb3J0cy5lcXVhbCA9IGVxdWFsO1xudmFyIEVudGl0eSA9IChmdW5jdGlvbiAoKSB7XG4gICAgLyoqXG4gICAgICogbW9jayBhbiBlbnRpdHkgaW5zdGFuY2Ugd2l0aCBpbml0IGRhdGFcbiAgICAgKiBAcGFyYW0gaW5pdERhdGFcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBFbnRpdHkoaW5pdERhdGEpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHN0b3JlIG9uZSBlbnRpdHkncyBkYXRhXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9kYXRhID0ge307XG4gICAgICAgIC8qKlxuICAgICAgICAgKiB0cmFjayBtb2RpZnkgZmllbGRcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubW9kaWZ5RmllbGRzID0gW107XG4gICAgICAgIHRoaXMucGF0Y2hEYXRhKGluaXREYXRhKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogZ2V0IHRoaXMgZW50aXR5J3Mgc3ByaW5nIGRhdGEgcmVzdCByZXNvdXJjZSB1cmkuXG4gICAgICogaWYgdGhpcyBlbnRpdHkncyBoYXMgZGF0YSBhbmQgZGF0YSBoYXMgX2xpbmsgcHJvcGVydGllcyx1c2UgX2RhdGFbJ19saW5rcyddWydzZWxmJ11bJ2hyZWYnXVxuICAgICAqIGVsc2UgdXNlIGNvbmZpZy5yZXN0QmFzZVVSTCArIGVudGl0eU5hbWUgKyAnLycgKyBzZWxmLmlkXG4gICAgICovXG4gICAgRW50aXR5LnByb3RvdHlwZS5ocmVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbGlua3MgPSB0aGlzLl9kYXRhWydfbGlua3MnXTtcbiAgICAgICAgaWYgKGxpbmtzICE9IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBsaW5rc1snc2VsZiddWydocmVmJ107XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLmVudGl0eUJhc2VVUkwoKSArIFwiL1wiICsgdGhpcy5pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImVudGl0eSB3aXRob3V0IGlkIGNhbid0IG1hcCB0byBiYWNrZW5kIHNlcnZpY2U6XFxuXCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGdldCBlbnRpdHkgcHJvcGVydGllcyB2YWx1ZSBieSBrZXlcbiAgICAgKiBAcGFyYW0ga2V5IHByb3BlcnRpZXMgbmFtZVxuICAgICAqL1xuICAgIEVudGl0eS5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZGF0YVtrZXldO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogc2V0IGVudGl0eSBwcm9wZXJ0aWVzIHZhbHVlIGJ5IGtleVxuICAgICAqIHdpbGwgY29tcGFyZSBvbGFWYWx1ZSBhbmQgbmV3VmFsdWUsaWYgdmFsdWUgaXMgZXF1YWwgdGhlbiBub3QgYXBwZW5kIGZpbGVkIG5hbWUgdG8gbW9kaWZ5RmllbGRzXG4gICAgICogQHBhcmFtIGtleSBwcm9wZXJ0aWVzIG5hbWVcbiAgICAgKiBAcGFyYW0gdmFsdWVcbiAgICAgKi9cbiAgICBFbnRpdHkucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMuZ2V0KGtleSk7XG4gICAgICAgIGlmICghZXF1YWwob2xkVmFsdWUsIHZhbHVlKSkge1xuICAgICAgICAgICAgdGhpcy5tb2RpZnlGaWVsZHMucHVzaChrZXkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2RhdGFba2V5XSA9IHZhbHVlO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogZ2V0IGVudGl0eSBkYXRhIHJlZlxuICAgICAqL1xuICAgIEVudGl0eS5wcm90b3R5cGUuZGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGE7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBhc3NpZ24gYSBwYXRjaERhdGEgb2JqZWN0IHRvIGVudGl0eSdzIHByb3BlcnRpZXNcbiAgICAgKiBpZiBwYXRjaERhdGEgaGFzIHNlbGYgbGluaywgdGhlbiBpZCB3aWxsIHVwZGF0ZSBieSBwYXJzZUlkRnJvbURhdGFcbiAgICAgKiBAcGFyYW0gcGF0Y2hEYXRhXG4gICAgICovXG4gICAgRW50aXR5LnByb3RvdHlwZS5wYXRjaERhdGEgPSBmdW5jdGlvbiAocGF0Y2hEYXRhKSB7XG4gICAgICAgIGZvciAodmFyIGtleSBpbiBwYXRjaERhdGEpIHtcbiAgICAgICAgICAgIGlmIChwYXRjaERhdGEuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0KGtleSwgcGF0Y2hEYXRhW2tleV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgaWQgPSBwYXRjaERhdGFbJ19saW5rcyddWydzZWxmJ11bJ2hyZWYnXS5zcGxpdCgvXFwvLyk7XG4gICAgICAgICAgICBpZCA9IGlkW2lkLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKF8pIHtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogY3JlYXRlIGFuIG5ldyBlbnRpdHlcbiAgICAgKiBzZW5kIEhUVFAgUE9TVCByZXF1ZXN0IHRvIGNyZWF0ZSBhbiBlbnRpdHlcbiAgICAgKi9cbiAgICBFbnRpdHkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIF90aGlzLmNvbnN0cnVjdG9yLnRyYW5zbGF0ZVJlbGF0aW9uRW50aXR5KF90aGlzLmRhdGEoKSkudGhlbihmdW5jdGlvbiAoYm9keSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXF1ZXN0LnBvc3QoX3RoaXMuY29uc3RydWN0b3IuZW50aXR5QmFzZVVSTCgpKS5qc29uQm9keShib2R5KS5zZW5kKCk7XG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChqc29uKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMucGF0Y2hEYXRhKGpzb24pO1xuICAgICAgICAgICAgICAgIF90aGlzLm1vZGlmeUZpZWxkcyA9IFtdO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoanNvbik7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiB1cGRhdGUgYW4gZW50aXR5XG4gICAgICogc2VuZCBIVFRQIFBBVENIIHJlcXVlc3QgdG8gdXBkYXRlIGFuIGVudGl0eSh3aWxsIHdhdGNoIGNoYW5nZSBpbiBkYXRhIHByb3BlcnRpZXMgdG8gdHJhY2sgY2hhbmdlIGZpZWxkcylcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gcmVzb2x2ZShqc29uKSwgcmVqZWN0KFJlcXVlc3QpXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBFbnRpdHkucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIHZhciBwdXJlQ2hhbmdlID0ge307XG4gICAgICAgICAgICBpZiAoX3RoaXMubW9kaWZ5RmllbGRzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLm1vZGlmeUZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgICAgICBpZiAocHVyZUNoYW5nZS5oYXNPd25Qcm9wZXJ0eShrZXkpIHx8IGtleVswXSA9PT0gJ18nKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoX3RoaXMuX2RhdGEuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgICAgICBwdXJlQ2hhbmdlW2tleV0gPSBfdGhpcy5nZXQoa2V5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIF90aGlzLmNvbnN0cnVjdG9yLnRyYW5zbGF0ZVJlbGF0aW9uRW50aXR5KHB1cmVDaGFuZ2UpLnRoZW4oZnVuY3Rpb24gKGpzb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVxdWVzdC5wYXRjaChfdGhpcy5ocmVmKCkpLmpzb25Cb2R5KGpzb24pLnNlbmQoKTtcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGpzb24pIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5wYXRjaERhdGEoanNvbik7XG4gICAgICAgICAgICAgICAgX3RoaXMubW9kaWZ5RmllbGRzID0gW107XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShqc29uKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGNyZWF0ZSBvciB1cGRhdGUgZW50aXR5XG4gICAgICogaWYgaWQgcHJvcGVydGllcyBpcyBzZXQgdXBkYXRlIGNoYW5nZSB0byBzZXJ2aWNlLFxuICAgICAqIGVsc2UgY3JlYXRlIGFuIG5ldyBlbnRpdHkgdG8gc2VydmljZS5cbiAgICAgKlxuICAgICAqIGlmIGVudGl0eS5wcm9wZXJ0aWVzIGlzIGFuIGluc3RhbmNlIG9mIEVudGl0eSBvciBFbnRpdHlbXSx0aGVuIGVudGl0eS5wcm9wZXJ0aWVzLnNhdmUoKSB3aWxsIGFsc28gY2FsbCx3aGljaCBtZWFuIGVudGl0eSdzIGFsbCBFbnRpdHkgYXR0ciB3aWxsIGF1dG8gc2F2ZSgpXG4gICAgICovXG4gICAgRW50aXR5LnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5pZCAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy51cGRhdGUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiByZW1vdmUgdGhpcyBlbnRpdHlcbiAgICAgKi9cbiAgICBFbnRpdHkucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IucmVtb3ZlKHRoaXMuaWQpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogZmV0Y2ggZW50aXR5IGRhdGEgdG8ga2VlcCB1cGRhdGVkIHRvIG5ld2VzdFxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSByZXNvbHZlKGpzb24pLCByZWplY3QoUmVxdWVzdClcbiAgICAgKi9cbiAgICBFbnRpdHkucHJvdG90eXBlLmZldGNoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICBfdGhpcy5jb25zdHJ1Y3Rvci5maW5kT25lKF90aGlzLmlkKS50aGVuKGZ1bmN0aW9uIChlbnRpdHkpIHtcbiAgICAgICAgICAgICAgICB2YXIganNvbiA9IGVudGl0eS5kYXRhKCk7XG4gICAgICAgICAgICAgICAgX3RoaXMucGF0Y2hEYXRhKGpzb24pO1xuICAgICAgICAgICAgICAgIF90aGlzLm1vZGlmeUZpZWxkcyA9IFtdO1xuICAgICAgICAgICAgICAgIHJlc29sZShqc29uKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIHNlbmQgcmVxdWVzdCBmb2xsb3cgdGhpcyBlbnRpdHkncyBfbGlua3MncyBocmVmXG4gICAgICogQHBhcmFtIHtzdHJpbmdbXX0ga2V5cyBsaW5rcyBocmVmIGluIG9yZGVyXG4gICAgICogQHJldHVybnMge1Byb21pc2V9IHJlc29sdmUoanNvbiksIHJlamVjdChSZXF1ZXN0KVxuICAgICAqL1xuICAgIEVudGl0eS5wcm90b3R5cGUuZm9sbG93ID0gZnVuY3Rpb24gKGtleXMpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbGUsIHJlamVjdCkge1xuICAgICAgICAgICAgZnVuY3Rpb24gZG9Gb2xsb3coZGF0YSkge1xuICAgICAgICAgICAgICAgIHJlcXVlc3QubW9ja1JlcXVlc3QoZGF0YSkuZm9sbG93KGtleXMpLnRoZW4oZnVuY3Rpb24gKGpzb24pIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2xlKGpzb24pO1xuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL2ZldGNoIGRhdGEgYmVmb3JlIGRvRm9sbG93XG4gICAgICAgICAgICBpZiAoX3RoaXMuX2RhdGFbJ19saW5rcyddICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBkb0ZvbGxvdyhfdGhpcy5kYXRhKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuZmV0Y2goKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9Gb2xsb3coX3RoaXMuZGF0YSgpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBmZXRjaCByZWxhdGlvbiBwcm9wZXJ0eSBhbmQgc3RvcmUgcmVzcG9uc2UgdmFsdWUgaW4gZW50aXR5J3MgZGF0YSBhdHRyLHJlbGF0aW9uIHByb3BlcnR5IGlzIGFuIGluc3RhbmNlIG9mIEVudGl0eS5cbiAgICAgKiBhZnRlciBmZXRjaCB5b3UgY2FuIGdldCByZWxhdGlvbiBwcm9wZXJ0eSBieSBnZXQocHJvcGVydHlOYW1lKVxuICAgICAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUgRW50aXR5IHJlbGF0aW9uIHByb3BlcnR5IG5hbWUgaW4gX2xpbmtzXG4gICAgICogQHBhcmFtIFQgcmVsYXRpb24gcHJvcGVydHkncyB0eXBlKGV4dGVuZCBFbnRpdHkgY2xhc3MpXG4gICAgICogQHJldHVybnMge1Byb21pc2U8VD59IHJlc29sdmUgRW50aXR5IHJlbGF0aW9uIHByb3BlcnR5IGluc3RhbmNlXG4gICAgICovXG4gICAgRW50aXR5LnByb3RvdHlwZS5mZXRjaFByb3BlcnR5ID0gZnVuY3Rpb24gKHByb3BlcnR5TmFtZSwgVCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgX3RoaXMuZm9sbG93KFtwcm9wZXJ0eU5hbWVdKS50aGVuKGZ1bmN0aW9uIChqc29uKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVudGl0eSA9IFQuanNvblRvRW50aXR5KGpzb24pO1xuICAgICAgICAgICAgICAgIF90aGlzLmRhdGEoKVtwcm9wZXJ0eU5hbWVdID0gZW50aXR5O1xuICAgICAgICAgICAgICAgIHJlc29sdmUoZW50aXR5KTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGZldGNoIHJlbGF0aW9uIHByb3BlcnR5IGFuZCBzdG9yZSByZXNwb25zZSB2YWx1ZSBpbiBlbnRpdHkncyBkYXRhIGF0dHIscmVsYXRpb24gcHJvcGVydHkgaXMgYW4gRW50aXR5IGFycmF5XG4gICAgICogYWZ0ZXIgZmV0Y2ggeW91IGNhbiBnZXQgcmVsYXRpb24gcHJvcGVydHkgYnkgZ2V0KHByb3BlcnR5TmFtZSlcbiAgICAgKiBAcGFyYW0gcHJvcGVydHlOYW1lIEVudGl0eSByZWxhdGlvbiBwcm9wZXJ0eSBuYW1lIGluIF9saW5rc1xuICAgICAqIEBwYXJhbSBUIHJlbGF0aW9uIHByb3BlcnR5J3MgdHlwZShleHRlbmQgRW50aXR5IGNsYXNzKVxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPFQ+fVxuICAgICAqL1xuICAgIEVudGl0eS5wcm90b3R5cGUuZmV0Y2hBcnJheVByb3BlcnR5ID0gZnVuY3Rpb24gKHByb3BlcnR5TmFtZSwgVCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgX3RoaXMuZm9sbG93KFtwcm9wZXJ0eU5hbWVdKS50aGVuKGZ1bmN0aW9uIChqc29uKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVudGl0aWVzID0gVC5qc29uVG9FbnRpdHlMaXN0KGpzb24pO1xuICAgICAgICAgICAgICAgIF90aGlzLmRhdGEoKVtwcm9wZXJ0eU5hbWVdID0gZW50aXRpZXM7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShlbnRpdGllcyk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBzcHJpbmcgZGF0YSByZXN0IGVudGl0eSBiYXNlIHVybFxuICAgICAqL1xuICAgIEVudGl0eS5lbnRpdHlCYXNlVVJMID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZXhwb3J0cy5lbnRpdHlDb25maWcucmVzdEJhc2VVUkwgKyBcIi9cIiArIHRoaXMuZW50aXR5TmFtZTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIHJlYWQgc3ByaW5nIGRhdGEgcmVzdCdzIHJlc3BvbnNlIGpzb24gZGF0YSB0aGVuIHBhcnNlIGFuZCByZXR1cm4gZW50aXR5IGFycmF5XG4gICAgICogQHBhcmFtIGpzb25cbiAgICAgKi9cbiAgICBFbnRpdHkuanNvblRvRW50aXR5TGlzdCA9IGZ1bmN0aW9uIChqc29uKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciByZSA9IFtdO1xuICAgICAgICB2YXIgYXJyID0ganNvblsnX2VtYmVkZGVkJ11bdGhpcy5lbnRpdHlOYW1lXTtcbiAgICAgICAgYXJyLmZvckVhY2goZnVuY3Rpb24gKGpzb24pIHtcbiAgICAgICAgICAgIHJlLnB1c2goX3RoaXMuanNvblRvRW50aXR5KGpzb24pKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJlWydwYWdlJ10gPSBqc29uWydwYWdlJ107IC8vYWRkIHBhZ2UgaW5mb1xuICAgICAgICByZXR1cm4gcmU7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiByZWFkIHNwcmluZyBkYXRhIHJlc3QncyByZXNwb25zZSBqc29uIGRhdGEgdGhlbiBwYXJzZSBhbmQgcmV0dXJuIGFuIGVudGl0eVxuICAgICAqIEBwYXJhbSBqc29uXG4gICAgICovXG4gICAgRW50aXR5Lmpzb25Ub0VudGl0eSA9IGZ1bmN0aW9uIChqc29uKSB7XG4gICAgICAgIHZhciBlbnRpdHkgPSBuZXcgdGhpcyhqc29uKTtcbiAgICAgICAgLy9qc29uIGRhdGEgZnJvbSBzZXJ2ZXIgaXMgZnJlc2gsc28gZW50aXR5IG1vZGlmeUZpZWxkcyBzaG91bGQgYmUgZW1wdHlcbiAgICAgICAgZW50aXR5Lm1vZGlmeUZpZWxkcyA9IFtdO1xuICAgICAgICByZXR1cm4gZW50aXR5O1xuICAgIH07XG4gICAgLyoqXG4gICAgICogdGhpcyBtZXRob2QgdXNlIGJlZm9yZSBzZW5kIHJlcXVlc3QgdG8gc2VydmljZSB0byBjcmVhdGUgb3IgdXBkYXRlIGVudGl0eVxuICAgICAqIHRyYW5zbGF0ZSBlbnRpdHkncyBkYXRhIHByb3BlcnRpZXMgd2hpY2ggY29udGFpbiBSZWxhdGlvbiBFbnRpdHkgaW5zdGFuY2UgdmFsdWUgdG8gdGV4dC11cmkgbGlzdFxuICAgICAqIGlmIGRhdGEgaGFzIEVudGl0eSBhdHRyLHRoaXMgRW50aXR5IGF0dHIgd2lsbCBiZSByZXBsYWNlIGJ5IGlzIGhyZWYoKSB2YWx1ZSxhbmQgaWYgdGhpcyBlbnRpdHkgaGFzJ3QgYmUgc3RvcmUgaW4gc2VydmljZSB3aWxsIHN0b3JlIHRoaXMgZW50aXR5IGZpcnN0LlxuICAgICAqIEBwYXJhbSBkYXRhIGVudGl0eSdzIGRhdGEgcHJvcGVydGllcyBjYW4gaGFzIEVudGl0eSBhdHRyXG4gICAgICpcbiAgICAgKiByZXNvbHZlOiBwdXJlIGpzb24gZGF0YSBjYW4gc2VuZCB0byBzcHJpbmcgZGF0YSByZXN0IHNlcnZpY2UgYXMgcmVxdWVzdCBib2R5XG4gICAgICogcmVqZWN0OiBSZXF1ZXN0IHdpdGggZXJyb3IgcHJvcFxuICAgICAqL1xuICAgIEVudGl0eS50cmFuc2xhdGVSZWxhdGlvbkVudGl0eSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICBpZiAoaXNFbnRpdHkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnNhdmUoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhLmhyZWYoKSk7XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZUxpc3RfMSA9IFtdO1xuICAgICAgICAgICAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbiAob25lKSB7IHJldHVybiBwcm9taXNlTGlzdF8xLnB1c2goX3RoaXMudHJhbnNsYXRlUmVsYXRpb25FbnRpdHkob25lKSk7IH0pO1xuICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKHByb21pc2VMaXN0XzEpLnRoZW4oZnVuY3Rpb24gKGFycikge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGFycik7XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGRhdGEgIT0gbnVsbCAmJiBkYXRhLmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZUxpc3QgPSBbXTtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXhLZXlNYXBfMSA9IHt9O1xuICAgICAgICAgICAgICAgIHZhciBub3dJbmRleCA9IDA7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhLZXlNYXBfMVtub3dJbmRleCsrXSA9IGtleTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2VMaXN0LnB1c2goX3RoaXMudHJhbnNsYXRlUmVsYXRpb25FbnRpdHkoZGF0YVtrZXldKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZUxpc3QpLnRoZW4oZnVuY3Rpb24gKGFycikge1xuICAgICAgICAgICAgICAgICAgICB2YXIganNvbiA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAganNvbltpbmRleEtleU1hcF8xW2ldXSA9IGFycltpXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGpzb24pO1xuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGdldCBlbnRpdHkganNvbiBkYXRhIGJ5IGlkXG4gICAgICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBpZCBlbnRpdHkgaWRcbiAgICAgKiBAcGFyYW0ge29iamVjdD99IHF1ZXJ5UGFyYW1cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcXVlcnlQYXJhbS5wcm9qZWN0aW9uIHRoZSBuYW1lIG9mIHRoZSBwcm9qZWN0aW9uIHlvdSBzZXQgd2l0aCBAUHJvamVjdGlvbiBhbm5vdGF0aW9uIG5hbWUgYXR0cmlidXRlc1xuICAgICAqL1xuICAgIEVudGl0eS5maW5kT25lID0gZnVuY3Rpb24gKGlkLCBxdWVyeVBhcmFtKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgIHJlcXVlc3QuZ2V0KF90aGlzLmVudGl0eUJhc2VVUkwoKSArIFwiL1wiICsgaWQpLnF1ZXJ5UGFyYW0ocXVlcnlQYXJhbSkuc2VuZCgpLnRoZW4oZnVuY3Rpb24gKGpzb24pIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShfdGhpcy5qc29uVG9FbnRpdHkoanNvbikpO1xuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncmVxdWlyZSBpZCcpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBjb2xsZWN0aW9uIHJlc291cmNlIHdpdGggcGFnZSBhbmQgc29ydC5cbiAgICAgKiBSZXR1cm5zIGFsbCBlbnRpdGllcyB0aGUgcmVwb3NpdG9yeSBzZXJ2ZXJzIHRocm91Z2ggaXRzIGZpbmRBbGwo4oCmKSBtZXRob2QuIElmIHRoZSByZXBvc2l0b3J5IGlzIGEgcGFnaW5nIHJlcG9zaXRvcnkgd2UgaW5jbHVkZSB0aGUgcGFnaW5hdGlvbiBsaW5rcyBpZiBuZWNlc3NhcnkgYW5kIGFkZGl0aW9uYWwgcGFnZSBtZXRhZGF0YS4qXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHF1ZXJ5UGFyYW1cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gcXVlcnlQYXJhbS5wYWdlIHRoZSBwYWdlIG51bWJlciB0byBhY2Nlc3MgKDAgaW5kZXhlZCwgZGVmYXVsdHMgdG8gMCkuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHF1ZXJ5UGFyYW0uc2l6ZSB0aGUgcGFnZSBzaXplIHJlcXVlc3RlZCAoZGVmYXVsdHMgdG8gMjApLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBxdWVyeVBhcmFtLnNvcnQgYSBjb2xsZWN0aW9uIG9mIHNvcnQgZGlyZWN0aXZlcyBpbiB0aGUgZm9ybWF0ICgkcHJvcGVydHlOYW1lLCkrW2FzY3xkZXNjXT9cbiAgICAgKiBldGM6bmFtZSxhZ2UsZGVzY1xuICAgICAqL1xuICAgIEVudGl0eS5maW5kQWxsID0gZnVuY3Rpb24gKHF1ZXJ5UGFyYW0pIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIHJlcXVlc3QuZ2V0KF90aGlzLmVudGl0eUJhc2VVUkwoKSkucXVlcnlQYXJhbShxdWVyeVBhcmFtKS5zZW5kKCkudGhlbihmdW5jdGlvbiAoanNvbikge1xuICAgICAgICAgICAgICAgIHZhciByZSA9IF90aGlzLmpzb25Ub0VudGl0eUxpc3QoanNvbik7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZSk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBzZWFyY2ggcmVzb3VyY2UgaWYgdGhlIGJhY2tpbmcgcmVwb3NpdG9yeSBleHBvc2VzIHF1ZXJ5IG1ldGhvZHMuXG4gICAgICogY2FsbCBxdWVyeSBtZXRob2RzIGV4cG9zZWQgYnkgYSByZXBvc2l0b3J5LiBUaGUgcGF0aCBhbmQgbmFtZSBvZiB0aGUgcXVlcnkgbWV0aG9kIHJlc291cmNlcyBjYW4gYmUgbW9kaWZpZWQgdXNpbmcgQFJlc3RSZXNvdXJjZSBvbiB0aGUgbWV0aG9kIGRlY2xhcmF0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHNlYXJjaFBhdGggc3ByaW5nIGRhdGEgcmVzdCBzZWFyY2hNZXRob2QgcGF0aCBzdHJpbmdcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBxdWVyeVBhcmFtIHNlYXJjaCBwYXJhbXNcbiAgICAgKiBJZiB0aGUgcXVlcnkgbWV0aG9kIGhhcyBwYWdpbmF0aW9uIGNhcGFiaWxpdGllcyAoaW5kaWNhdGVkIGluIHRoZSBVUkkgdGVtcGxhdGUgcG9pbnRpbmcgdG8gdGhlIHJlc291cmNlKSB0aGUgcmVzb3VyY2UgdGFrZXMgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBxdWVyeVBhcmFtLnBhZ2UgdGhlIHBhZ2UgbnVtYmVyIHRvIGFjY2VzcyAoMCBpbmRleGVkLCBkZWZhdWx0cyB0byAwKS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gcXVlcnlQYXJhbS5zaXplIHRoZSBwYWdlIHNpemUgcmVxdWVzdGVkIChkZWZhdWx0cyB0byAyMCkuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHF1ZXJ5UGFyYW0uc29ydCBhIGNvbGxlY3Rpb24gb2Ygc29ydCBkaXJlY3RpdmVzIGluIHRoZSBmb3JtYXQgKCRwcm9wZXJ0eU5hbWUsKStbYXNjfGRlc2NdP1xuICAgICAqXG4gICAgICogQHJldHVybnMge1Byb21pc2V9IHJlc29sdmUoRW50aXR5fEVudGl0eVtdKSByZWplY3QoUmVxdWVzdClcbiAgICAgKiByZXNvbHZlOlxuICAgICAqICAgICAgaWYgcmVzcG9uc2UganNvbiBkYXRhIGhhcyBfZW1iZWRkZWQgYXR0ciB0aGVuIHJlc29sdmUgRW50aXR5IGFycmF5LFxuICAgICAqICAgICAgZWxzZSByZXNvbHZlIG9uZSBFbnRpdHlcbiAgICAgKi9cbiAgICBFbnRpdHkuc2VhcmNoID0gZnVuY3Rpb24gKHNlYXJjaFBhdGgsIHF1ZXJ5UGFyYW0pIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIHJlcXVlc3QuZ2V0KF90aGlzLmVudGl0eUJhc2VVUkwoKSArIFwiL3NlYXJjaC9cIiArIHNlYXJjaFBhdGgpLnF1ZXJ5UGFyYW0ocXVlcnlQYXJhbSkuc2VuZCgpLnRoZW4oZnVuY3Rpb24gKGpzb24pIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF90aGlzLmpzb25Ub0VudGl0eUxpc3QoanNvbikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoXykge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF90aGlzLmpzb25Ub0VudGl0eShqc29uKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogcmVtb3ZlIGVudGl0eSBieSBpZFxuICAgICAqL1xuICAgIEVudGl0eS5yZW1vdmUgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcXVlc3QuZGVsZXRlTWV0aG9kKHRoaXMuZW50aXR5QmFzZVVSTCgpICsgXCIvXCIgKyBpZCkuc2VuZCgpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogZXhwb3NlIGVudGl0eSBpbnN0YW5jZSBwcm9wZXJ0aWVzIGluIF9kYXRhIHRvIGVudGl0eSBpdHNlbGYgdXNlIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSBnZXR0ZXIgYW5kIHNldHRlclxuICAgICAqIGFmdGVyIGV4cG9zZSx5b3UgY2FuIGFjY2VzcyBwcm9wZXJ0eSBpbiBlbnRpdHkgYnkgZW50aXR5LnByb3BlcnR5IHJhdGhlciB0aGFuIGFjY2VzcyBieSBlbnRpdHkuZGF0YSgpLnByb3BlcnR5XG4gICAgICogQHBhcmFtIHByb3BlcnR5TmFtZSBwcm9wZXJ0eSBuYW1lIGluIGVudGl0eS5kYXRhKCkgb2JqZWN0LlxuICAgICAqL1xuICAgIEVudGl0eS5leHBvc2VQcm9wZXJ0eSA9IGZ1bmN0aW9uIChwcm9wZXJ0eU5hbWUpIHtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMucHJvdG90eXBlLCBwcm9wZXJ0eU5hbWUsIHtcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldChwcm9wZXJ0eU5hbWUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXQocHJvcGVydHlOYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHJldHVybiBFbnRpdHk7XG59KCkpO1xuZXhwb3J0cy5FbnRpdHkgPSBFbnRpdHk7XG4vKipcbiAqIGJ1aWxkIGFuIEVudGl0eSBFbnRpdHlcbiAqIEBwYXJhbSBlbnRpdHlfbmFtZSBzcHJpbmcgZGF0YSByZXN0IGVudGl0eSBwYXRoXG4gKi9cbmZ1bmN0aW9uIGV4dGVuZChlbnRpdHlfbmFtZSkge1xuICAgIHZhciBDbGFzcyA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhDbGFzcywgX3N1cGVyKTtcbiAgICAgICAgZnVuY3Rpb24gQ2xhc3MoKSB7XG4gICAgICAgICAgICBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ2xhc3M7XG4gICAgfShFbnRpdHkpKTtcbiAgICAvKipcbiAgICAgKiBzcHJpbmcgZGF0YSByZXN0IGVudGl0eSBwYXRoXG4gICAgICovXG4gICAgQ2xhc3MuZW50aXR5TmFtZSA9IGVudGl0eV9uYW1lO1xuICAgIHJldHVybiBDbGFzcztcbn1cbmV4cG9ydHMuZXh0ZW5kID0gZXh0ZW5kO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZW50aXR5LmpzLm1hcFxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vZW50aXR5LmpzXG4vLyBtb2R1bGUgaWQgPSAzXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");
},,/*!********************!*\
  !*** multi spring ***!
  \********************/
function(g,I,C){g.exports=C(/*! ./browser.js */2)}]);